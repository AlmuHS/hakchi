#!/bin/sh
installpath=/var/lib/hakchi
rootfs=$installpath/rootfs
gamesdir=$rootfs/usr/share/games/nes/kachikachi
state_file=$installpath/menu
echo switching to menu $1
echo $1>$state_file
if [ "$1" == "000" ]; then
  targetdir=$gamesdir
else
  targetdir=$gamesdir/$1
fi
echo new directory: $targetdir
if [ ! -f $targetdir/title.fnt ]; then
  ln -s $gamesdir/title.fnt $targetdir/title.fnt
fi
if [ ! -f $targetdir/copyright.fnt ]; then
  ln -s $gamesdir/copyright.fnt $targetdir/copyright.fnt
fi

pkill -KILL clover-mcp
pkill -KILL ReedPlayer-Clover

umount -f /usr/share/games/nes/kachikachi
mount -o bind $targetdir /usr/share/games/nes/kachikachi
clover-mcp

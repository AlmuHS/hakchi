source "$modpath/script/backup"
source "$modpath/script/install"
source "$modpath/script/package"
source "$modpath/script/games"

backup_nandc
mount_base
backup

[ -f "$preinitpath/p0000_config" ] && source "$preinitpath/p0000_config"

if [ -f "$preinit" ]; then
  echo $modname already installed
  mod_repair
else
  mod_install
fi

local transferpath=$modpath/transfer

packs_uninstall $(cat "$transferpath/uninstall")
packs_uninstall $(cat "$transferpath/hmod/uninstall")

packs_install "$transferpath"
if [ -d "$transferpath/hmod" ]; then
  packs_install "$transferpath/hmod"
  rm -rf "$transferpath/hmod"
fi

transfer_games "$transferpath/games"

echo transferring data...
transfer_path "$transferpath"

source "$preinitpath/pffff_config"
[ "$cf_shutdown" != "y" ] || shutdown
